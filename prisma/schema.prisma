generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model BatchSessionPost {
  id             String       @id
  sessionId      String       @map("session_id")
  postId         String       @map("post_id")
  order          Int          @default(0)
  recordingNotes String?      @map("recording_notes")
  post           Post         @relation(fields: [postId], references: [id])
  batchSession   BatchSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, postId])
  @@index([sessionId])
  @@map("batch_session_posts")
}

model BatchSession {
  id                String             @id
  title             String
  scheduledDate     DateTime           @map("scheduled_date") @db.Date
  notes             String?
  status            String             @default("PLANNED")
  createdById       String             @map("created_by_id")
  batchSessionPosts BatchSessionPost[]
  user              User               @relation(fields: [createdById], references: [id])

  @@index([scheduledDate])
  @@map("batch_sessions")
}

model ChecklistCompletion {
  id              String            @id
  postId          String            @map("post_id")
  templateId      String            @map("template_id")
  completedItems  String            @default("[]") @map("completed_items")
  completedAt     DateTime?         @map("completed_at")
  post            Post              @relation(fields: [postId], references: [id], onDelete: Cascade)
  checklistTemplate ChecklistTemplate @relation(fields: [templateId], references: [id])

  @@unique([postId, templateId])
  @@map("checklist_completions")
}

model ChecklistTemplate {
  id                   String                @id
  stage                String                @unique
  items                String                @default("[]")
  checklistCompletions ChecklistCompletion[]

  @@map("checklist_templates")
}

model ClientResult {
  id              String        @id
  clientName      String        @map("client_name")
  clientNiche     String        @map("client_niche")
  metricType      String        @map("metric_type")
  metricValue     String        @map("metric_value")
  metricUnit      String        @default("") @map("metric_unit")
  period          String
  description     String        @default("")
  testimonialText String?       @map("testimonial_text")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @default(now()) @map("updated_at")
  resultImages    ResultImage[]

  @@map("client_results")
}

model CommissionConfig {
  id        String   @id
  format    String   @unique
  cpmValue  Float    @map("cpm_value")
  updatedAt DateTime @default(now()) @map("updated_at")

  @@map("commission_configs")
}

model Commission {
  id             String      @id
  userId         String      @map("user_id")
  metricId       String      @map("metric_id")
  amount         Float
  monthReference String      @map("month_reference")
  isPaid         Boolean     @default(false) @map("is_paid")
  paidAt         DateTime?   @map("paid_at")
  createdAt      DateTime    @default(now()) @map("created_at")
  postMetric     PostMetrics @relation(fields: [metricId], references: [id], onDelete: Cascade)
  user           User        @relation(fields: [userId], references: [id])

  @@index([metricId])
  @@index([monthReference])
  @@index([userId])
  @@map("commissions")
}

model ContentPillar {
  id               String  @id
  name             String
  slug             String  @unique
  color            String
  targetPercentage Int     @map("target_percentage")
  description      String  @default("")
  isActive         Boolean @default(true) @map("is_active")
  order            Int     @default(0)
  hooks            Hook[]
  posts            Post[]

  @@map("content_pillars")
}

model Hook {
  id            String         @id
  text          String
  pillarId      String?        @map("pillar_id")
  format        String         @default("ALL")
  category      String         @default("QUESTION")
  usageCount    Int            @default(0) @map("usage_count")
  isActive      Boolean        @default(true) @map("is_active")
  contentPillar ContentPillar? @relation(fields: [pillarId], references: [id])

  @@index([category])
  @@index([format])
  @@index([pillarId])
  @@map("hooks")
}

model PostMetrics {
  id              String        @id
  postId          String?       @map("post_id")
  socialAccountId String        @map("social_account_id")
  externalId      String        @unique @map("external_id")
  platform        String
  views           Int           @default(0)
  likes           Int           @default(0)
  comments        Int           @default(0)
  shares          Int           @default(0)
  postUrl         String        @default("") @map("post_url")
  thumbnailUrl    String        @default("") @map("thumbnail_url")
  caption         String?
  mediaType       String?       @map("media_type")
  publishedAt     DateTime      @map("published_at")
  syncedAt        DateTime      @default(now()) @map("synced_at")
  commissions     Commission[]
  post            Post?         @relation(fields: [postId], references: [id])
  socialAccount   SocialAccount @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)

  @@index([platform])
  @@index([postId])
  @@index([publishedAt])
  @@index([socialAccountId])
  @@map("post_metrics")
}

model Post {
  id                   String                @id
  title                String
  hook                 String?
  body                 String?
  caption              String?
  hashtags             String?
  format               String                @default("REEL")
  pillarId             String                @map("pillar_id")
  status               String                @default("IDEA")
  scheduledDate        DateTime?             @map("scheduled_date") @db.Date
  assignedTo           String?               @map("assigned_to")
  createdById          String?               @map("created_by_id")
  createdAt            DateTime              @default(now()) @map("created_at")
  updatedAt            DateTime              @default(now()) @map("updated_at")
  batchSessionPosts    BatchSessionPost[]
  checklistCompletions ChecklistCompletion[]
  postMetrics          PostMetrics[]
  user                 User?                 @relation(fields: [createdById], references: [id])
  contentPillar        ContentPillar         @relation(fields: [pillarId], references: [id])

  @@index([createdById])
  @@index([pillarId])
  @@index([scheduledDate])
  @@index([status])
  @@map("posts")
}

model ResultImage {
  id           String       @id
  resultId     String       @map("result_id")
  url          String
  altText      String       @default("") @map("alt_text")
  type         String       @default("SCREENSHOT")
  clientResult ClientResult @relation(fields: [resultId], references: [id], onDelete: Cascade)

  @@index([resultId])
  @@map("result_images")
}

model SocialAccount {
  id                String        @id
  userId            String        @map("user_id")
  platform          String
  displayName       String        @map("display_name")
  username          String
  profilePictureUrl String        @default("") @map("profile_picture_url")
  followersCount    Int           @default(0) @map("followers_count")
  igUserId          String?       @map("ig_user_id")
  accessToken       String?       @map("access_token")
  tokenExpiresAt    DateTime?     @map("token_expires_at")
  tiktokOpenId      String?       @map("tiktok_open_id")
  tiktokToken       String?       @map("tiktok_token")
  tiktokRefresh     String?       @map("tiktok_refresh")
  tiktokExpiresAt   DateTime?     @map("tiktok_expires_at")
  autoSync          Boolean       @default(false) @map("auto_sync")
  lastSyncAt        DateTime?     @map("last_sync_at")
  isActive          Boolean       @default(true) @map("is_active")
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @default(now()) @map("updated_at")
  postMetrics        PostMetrics[]
  syncLogs           SyncLog[]
  goals              Goal[]
  followerSnapshots  FollowerSnapshot[]
  user               User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([platform, username])
  @@index([userId])
  @@map("social_accounts")
}

model Goal {
  id              String        @id @default(cuid())
  socialAccountId String        @map("social_account_id")
  metricType      String        @map("metric_type")
  targetValue     Int           @map("target_value")
  currentValue    Int           @default(0) @map("current_value")
  startValue      Int           @default(0) @map("start_value")
  period          String
  startDate       DateTime      @default(now()) @map("start_date")
  endDate         DateTime      @map("end_date")
  status          String        @default("active")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  socialAccount   SocialAccount @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)

  @@index([socialAccountId])
  @@index([status])
  @@map("goals")
}

model FollowerSnapshot {
  id              String        @id @default(cuid())
  socialAccountId String        @map("social_account_id")
  followersCount  Int           @map("followers_count")
  snapshotDate    DateTime      @default(now()) @map("snapshot_date")

  socialAccount   SocialAccount @relation(fields: [socialAccountId], references: [id], onDelete: Cascade)

  @@unique([socialAccountId, snapshotDate])
  @@index([socialAccountId])
  @@map("follower_snapshots")
}

model SyncLog {
  id           String        @id
  accountId    String        @map("account_id")
  platform     String
  trigger      String
  postsFound   Int           @default(0) @map("posts_found")
  postsSynced  Int           @default(0) @map("posts_synced")
  status       String
  errorMessage String?       @map("error_message")
  duration     Int           @default(0)
  createdAt    DateTime      @default(now()) @map("created_at")
  account      SocialAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([accountId])
  @@index([platform])
  @@index([createdAt])
  @@map("sync_logs")
}

model User {
  id             String          @id
  name           String
  email          String          @unique
  password       String
  role           String          @default("member")
  isActive       Boolean         @default(true) @map("is_active")
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @default(now()) @map("updated_at")
  batchSessions  BatchSession[]
  commissions    Commission[]
  posts          Post[]
  socialAccounts SocialAccount[]

  @@map("users")
}
