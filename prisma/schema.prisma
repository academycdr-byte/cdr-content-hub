generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============ AUTH & USERS ============

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      String   @default("member")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  posts          Post[]
  batchSessions  BatchSession[]

  @@map("users")
}

// ============ CONTENT PILLARS ============

model ContentPillar {
  id               String  @id @default(cuid())
  name             String
  slug             String  @unique
  color            String
  targetPercentage Int     @map("target_percentage")
  description      String  @default("")
  isActive         Boolean @default(true) @map("is_active")
  order            Int     @default(0)

  posts Post[]
  hooks Hook[]

  @@map("content_pillars")
}

// ============ POSTS ============

model Post {
  id            String    @id @default(cuid())
  title         String
  hook          String?
  body          String?
  caption       String?
  hashtags      String?
  format        String    @default("REEL")
  pillarId      String    @map("pillar_id")
  status        String    @default("IDEA")
  scheduledDate DateTime? @map("scheduled_date") @db.Date
  assignedTo    String?   @map("assigned_to")
  createdById   String?   @map("created_by_id")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @default(now()) @updatedAt @map("updated_at")

  pillar              ContentPillar        @relation(fields: [pillarId], references: [id])
  createdBy           User?                @relation(fields: [createdById], references: [id])
  checklistCompletions ChecklistCompletion[]
  batchSessionPosts   BatchSessionPost[]

  @@index([pillarId])
  @@index([status])
  @@index([scheduledDate])
  @@index([createdById])
  @@map("posts")
}

// ============ HOOKS ============

model Hook {
  id         String  @id @default(cuid())
  text       String
  pillarId   String? @map("pillar_id")
  format     String  @default("ALL")
  category   String  @default("QUESTION")
  usageCount Int     @default(0) @map("usage_count")
  isActive   Boolean @default(true) @map("is_active")

  pillar ContentPillar? @relation(fields: [pillarId], references: [id])

  @@index([pillarId])
  @@index([format])
  @@index([category])
  @@map("hooks")
}

// ============ CHECKLISTS ============

model ChecklistTemplate {
  id    String @id @default(cuid())
  stage String
  items String @default("[]")

  completions ChecklistCompletion[]

  @@unique([stage])
  @@map("checklist_templates")
}

model ChecklistCompletion {
  id             String    @id @default(cuid())
  postId         String    @map("post_id")
  templateId     String    @map("template_id")
  completedItems String    @default("[]") @map("completed_items")
  completedAt    DateTime? @map("completed_at")

  post     Post              @relation(fields: [postId], references: [id], onDelete: Cascade)
  template ChecklistTemplate @relation(fields: [templateId], references: [id])

  @@unique([postId, templateId])
  @@map("checklist_completions")
}

// ============ CLIENT RESULTS ============

model ClientResult {
  id              String   @id @default(cuid())
  clientName      String   @map("client_name")
  clientNiche     String   @map("client_niche")
  metricType      String   @map("metric_type")
  metricValue     String   @map("metric_value")
  metricUnit      String   @default("") @map("metric_unit")
  period          String
  description     String   @default("")
  testimonialText String?  @map("testimonial_text")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at")

  images ResultImage[]

  @@map("client_results")
}

model ResultImage {
  id       String @id @default(cuid())
  resultId String @map("result_id")
  url      String
  altText  String @default("") @map("alt_text")
  type     String @default("SCREENSHOT")

  result ClientResult @relation(fields: [resultId], references: [id], onDelete: Cascade)

  @@index([resultId])
  @@map("result_images")
}

// ============ BATCH SESSIONS ============

model BatchSession {
  id            String   @id @default(cuid())
  title         String
  scheduledDate DateTime @map("scheduled_date") @db.Date
  notes         String?
  status        String   @default("PLANNED")
  createdById   String   @map("created_by_id")

  createdBy User               @relation(fields: [createdById], references: [id])
  posts     BatchSessionPost[]

  @@index([scheduledDate])
  @@map("batch_sessions")
}

model BatchSessionPost {
  id             String  @id @default(cuid())
  sessionId      String  @map("session_id")
  postId         String  @map("post_id")
  order          Int     @default(0)
  recordingNotes String? @map("recording_notes")

  session BatchSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  post    Post         @relation(fields: [postId], references: [id])

  @@unique([sessionId, postId])
  @@index([sessionId])
  @@map("batch_session_posts")
}
